
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Results Database &#8212; Sistemi Lente/Prism Test System 0.6.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development" href="_development.html" />
    <link rel="prev" title="Production Planning" href="_prodplan.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="_development.html" title="Development"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="_prodplan.html" title="Production Planning"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Sistemi Lente/Prism Test System 0.6.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Results Database</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="results-database">
<h1>Results Database<a class="headerlink" href="#results-database" title="Permalink to this headline">¶</a></h1>
<p>All things databse related.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#database-schema" id="id1">Database Schema</a></p>
<ul>
<li><p><a class="reference internal" href="#record" id="id2">record</a></p></li>
<li><p><a class="reference internal" href="#test-item" id="id3">test_item</a></p></li>
<li><p><a class="reference internal" href="#measurement" id="id4">measurement</a></p></li>
<li><p><a class="reference internal" href="#blob" id="id5">blob</a></p></li>
<li><p><a class="reference internal" href="#log" id="id6">log</a></p></li>
<li><p><a class="reference internal" href="#jsonb" id="id7">jsonb</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#sql-queries" id="id8">SQL Queries</a></p>
<ul>
<li><p><a class="reference internal" href="#stats-for-all-measurements" id="id9">Stats For All Measurements</a></p></li>
<li><p><a class="reference internal" href="#test-item-duration" id="id10">Test Item Duration</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="database-schema">
<h2><a class="toc-backref" href="#id1">Database Schema</a><a class="headerlink" href="#database-schema" title="Permalink to this headline">¶</a></h2>
<p>This diagram shows the dB schema and relationships,</p>
<img alt="_images/db_schema_01.png" src="_images/db_schema_01.png" />
<p>All of the tables are connected together thru the (foriegn key) <cite>record_id</cite>.</p>
<section id="record">
<h3><a class="toc-backref" href="#id2">record</a><a class="headerlink" href="#record" title="Permalink to this headline">¶</a></h3>
<p>This represents the instance of a test that ran.  Its a top level record that captures
all the conditions of the test when it ran.</p>
<p>The <cite>info_*</cite> section are fields that are set via the Prism Configuration and are related
to the the <cite>info</cite> section of the script.</p>
<p>The <cite>key#</cite> items are indexed keys that your script can set via <cite>add_key()</cite> api.  These keys should be used
as high level identifiers for making SQL queries.  For example, a product serial number
should probably be a key so that you can find the test record for a product serial number.
Typically these <cite>key#</cite> fields are not known until the test is run and retrieves the information.
For example, a key might be a microcontroller UID (MAC address) which is read at test time.</p>
</section>
<section id="test-item">
<h3><a class="toc-backref" href="#id3">test_item</a><a class="headerlink" href="#test-item" title="Permalink to this headline">¶</a></h3>
<p>For each test <cite>record</cite> there will multiple <cite>test_items</cite> as directed by the script.</p>
<p>Note that the name of the test item should be treated like a serial number and should be “formatted”.
See naming proposals.</p>
</section>
<section id="measurement">
<h3><a class="toc-backref" href="#id4">measurement</a><a class="headerlink" href="#measurement" title="Permalink to this headline">¶</a></h3>
<p>For each <cite>test_item</cite> there may be multiple <cite>measurements</cite>.  measurement has two foreign keys, <cite>record</cite>
and <cite>test_item</cite>.</p>
<p>Note that the name of the measurement should be treated like a serial number and should be “formatted”.
See naming proposals.  Prism <cite>measurement()</cite> API enforces good naming.</p>
</section>
<section id="blob">
<h3><a class="toc-backref" href="#id5">blob</a><a class="headerlink" href="#blob" title="Permalink to this headline">¶</a></h3>
<p>For each <cite>test_item</cite> there may be multiple JSON <cite>blob</cite>.  blob has two foreign keys, <cite>record</cite>
and <cite>test_item</cite>.</p>
</section>
<section id="log">
<h3><a class="toc-backref" href="#id6">log</a><a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h3>
<p>A large string that represents the <cite>log_bullet()</cite> messages that appear in the GUI.  This
represents what was shown to the operator during the test.</p>
</section>
<section id="jsonb">
<h3><a class="toc-backref" href="#id7">jsonb</a><a class="headerlink" href="#jsonb" title="Permalink to this headline">¶</a></h3>
<p><em>NOTE this feature is experimental.</em></p>
<p>A custom JSON object that will be stored as a <cite>jsonb</cite> object which Postgres treats special
(see Postgres documentation).</p>
<p>Using <cite>jsonb</cite> is provided to allow one to essentially create their own “tables” in JSON.</p>
</section>
</section>
<section id="sql-queries">
<h2><a class="toc-backref" href="#id8">SQL Queries</a><a class="headerlink" href="#sql-queries" title="Permalink to this headline">¶</a></h2>
<p>Lente provides only basic test result monitoring or “dashboarding”.  Because all Prism results end up in
an SQL database, adding dashboarding relevant for your business is easy.  The difficult part is choosing
among the many 3rd party options.</p>
<p>There are two classes of tools, those for developing SQL scripts, exploring the database schema, and those for
creating dashboards.</p>
<p>An example of a dashboarding tool is,</p>
<ul class="simple">
<li><p><a class="reference external" href="https://grafana.com/">Grafana</a></p></li>
</ul>
<p>An example of an SQL Tool is,</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dbeaver.io/">dBeaver</a></p></li>
</ul>
<p>Note that the Lente Details console page has an SQL window at the bottom which shows the SQL query that
Lente is using, and may provide a starting point for your own queries.</p>
<section id="stats-for-all-measurements">
<h3><a class="toc-backref" href="#id9">Stats For All Measurements</a><a class="headerlink" href="#stats-for-all-measurements" title="Permalink to this headline">¶</a></h3>
<p>An SQL script that will list all the measurements for a given set of records that meet the filtering criteria,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Measurement</span> <span class="n">Stats</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">test</span> <span class="n">measurements</span>
<span class="n">select</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
       <span class="n">count</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="n">count_val</span><span class="p">,</span>
       <span class="n">AVG</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">avg_val</span><span class="p">,</span>
       <span class="n">stddev</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">std_val</span><span class="p">,</span>
       <span class="nb">min</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">min_val</span><span class="p">,</span>
       <span class="nb">max</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">value</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">max_val</span>
<span class="kn">from</span> <span class="nn">measurement</span> <span class="n">m</span> <span class="n">join</span> <span class="n">record</span> <span class="n">on</span> <span class="n">m</span><span class="o">.</span><span class="n">record_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
<span class="n">where</span> <span class="n">m</span><span class="o">.</span><span class="n">unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;STR&#39;</span><span class="p">,</span> <span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
       <span class="o">--</span> <span class="n">add</span><span class="o">/</span><span class="n">remove</span> <span class="n">filters</span> <span class="k">as</span> <span class="n">required</span><span class="p">,</span> <span class="n">see</span> <span class="n">schema</span> <span class="k">for</span> <span class="n">fields</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_product</span> <span class="o">=</span> <span class="s1">&#39;myproduct&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_bom</span> <span class="o">=</span> <span class="s1">&#39;mybom&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_lot</span> <span class="o">=</span> <span class="s1">&#39;mylot&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_location</span> <span class="o">=</span> <span class="s1">&#39;mylocation&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_result</span> <span class="o">=</span> <span class="s1">&#39;PASS&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_script</span> <span class="o">=</span> <span class="s1">&#39;public/prism/scripts/mystage/myname.scr&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_start</span> <span class="o">&gt;=</span> <span class="s1">&#39;2023-11-10&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_start</span> <span class="o">&lt;=</span> <span class="s1">&#39;2023-11-15&#39;</span>
       <span class="n">group</span> <span class="n">by</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span>
       <span class="n">order</span> <span class="n">by</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</section>
<section id="test-item-duration">
<h3><a class="toc-backref" href="#id10">Test Item Duration</a><a class="headerlink" href="#test-item-duration" title="Permalink to this headline">¶</a></h3>
<p>An SQL script that will list all the stats for Test Item durations (how long did the test take),</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Test</span> <span class="n">Time</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">test</span> <span class="n">measurements</span>
<span class="n">select</span> <span class="n">ti</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
       <span class="n">count</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span><span class="p">)</span> <span class="n">count_val</span><span class="p">,</span>
       <span class="n">AVG</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">avg_val</span><span class="p">,</span>
       <span class="n">stddev</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">std_val</span><span class="p">,</span>
       <span class="nb">min</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">min_val</span><span class="p">,</span>
       <span class="nb">max</span><span class="p">(</span><span class="n">CAST</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span> <span class="k">as</span> <span class="n">Float</span><span class="p">))</span> <span class="n">max_val</span>
<span class="kn">from</span> <span class="nn">test_item</span> <span class="n">ti</span> <span class="n">join</span> <span class="n">record</span> <span class="n">on</span> <span class="n">ti</span><span class="o">.</span><span class="n">record_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
<span class="n">where</span> <span class="n">record</span><span class="o">.</span><span class="n">info_product</span> <span class="o">=</span> <span class="s1">&#39;myproduct&#39;</span>
       <span class="o">--</span> <span class="n">add</span><span class="o">/</span><span class="n">remove</span> <span class="n">filters</span> <span class="k">as</span> <span class="n">required</span><span class="p">,</span> <span class="n">see</span> <span class="n">schema</span> <span class="k">for</span> <span class="n">fields</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_bom</span> <span class="o">=</span> <span class="s1">&#39;mybom&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_lot</span> <span class="o">=</span> <span class="s1">&#39;mylot&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">info_location</span> <span class="o">=</span> <span class="s1">&#39;mylocation&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_result</span> <span class="o">=</span> <span class="s1">&#39;PASS&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_script</span> <span class="o">=</span> <span class="s1">&#39;public/prism/scripts/mystage/myname.scr&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_start</span> <span class="o">&gt;=</span> <span class="s1">&#39;2023-11-10&#39;</span>
       <span class="n">AND</span> <span class="n">record</span><span class="o">.</span><span class="n">meta_start</span> <span class="o">&lt;=</span> <span class="s1">&#39;2023-11-15&#39;</span>
       <span class="ow">and</span> <span class="n">CAST</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">_duration</span> <span class="k">as</span> <span class="n">Float</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.2</span>
       <span class="n">group</span> <span class="n">by</span> <span class="n">ti</span><span class="o">.</span><span class="n">name</span>
       <span class="n">order</span> <span class="n">by</span> <span class="n">ti</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="_prodplan.html"
                        title="previous chapter">Production Planning</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="_development.html"
                        title="next chapter">Development</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="_development.html" title="Development"
             >next</a> |</li>
        <li class="right" >
          <a href="_prodplan.html" title="Production Planning"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Sistemi Lente/Prism Test System 0.6.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Results Database</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019-2023, Sistemi Corp..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>